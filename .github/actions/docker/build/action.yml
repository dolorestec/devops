name: Build Image
description: "Build a docker image"

inputs:
  image:
    description: "Name of the image to build"
    required: true
  tag:
    description: "Tag of the image to build"
    required: true
  context:
    description: "Path to the build context"
    required: true
  dockerfile:
    description: "Path to the Dockerfile"
    required: true
  cache-to:
    description: "Cache the image to this registry"
    required: false
    default: "type=gha,ref=docker.pkg.github.com/${{ github.repository }}/cache"
  cache-from:
    description: "Cache the image from this registry"
    required: false 
    default: "type=gha,ref=docker.pkg.github.com/${{ github.repository }}/cache"
  push:
    description: "Push the image to the registry"
    required: false


runs:
  using: composite
  steps:
    - name: Docker image build
      shell: bash
      run: |
        echo "Docker image build "
        echo "# Name: ${{ inputs.image }}"
        echo "# Version: ${{ inputs.tag }}"
        echo "# Context: ${{ inputs.context }}"
        echo "# Dockerfile: ${{ inputs.dockerfile }}"
        echo "# Cache from: ${{ inputs.cache-from }}"
        echo "# Cache to: ${{ inputs.cache-to }}"
        echo "# Push: ${{ inputs.push }}" 

        docker buildx build "${{ inputs.context }}" --tag ${{ inputs.image }}:${{ inputs.tag }} \
        --cache-to ${{ inputs.cache-to }} --cache-from ${{ inputs.cache-from }} \
        --file ${{ inputs.dockerfile }} $([[ -z "${{ inputs.push }}" ]] || --push)