name: Upload
description: "Upload a docker image to a registry"

runs:
  using: composite
  steps:
    - name: Docker login
      shell: bash
      run: |
        echo "Logging in to docker";
        echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin;

    - name: Docker image upload
      shell: bash
      run: |
        echo "Uploading docker image ${{ env.DLRS_NAME }}:${{ env.DLRS_VERSION }}";
        docker push ${{ github.DLRS_NAME }}:${{ github.DLRS_VERSION }};

    - name: Docker logout
      shell: bash
      run: |
        echo "Logging out of docker";
        docker logout;
