name: Gitflow Workflow
run-name: Gitflow ${{ github.ref_name }}

on:
    workflow_call:

jobs:
    create:
        name: Release Branch
        timeout-minutes: 10
        runs-on: ubuntu-latest
        environment: ${{ github.ref_name }}

        steps:
          - name: Checkout code
            env:
              REPOSITORY: ${{ github.repository }}
              REF: ${{ github.ref_name }}
              FETCH_DEPTH: 0
            uses: Actions/checkout@v3
            with:
              repository: ${{ env.REPOSITORY }}
              ref: ${{ env.REF }}
              fetch-depth: ${{ env.FETCH_DEPTH }}

          - name: Load variables
            uses: dolorestec/devops/.github/actions/variables/load@develop
              
          - name: Check branch
            id: check_branch
            run: |
              if [[ "${{ github.ref_name }}" == "main"* ]]; then
                echo "hotfix" >> $GITHUB_OUTPUT
              elif [[ "${{ github.ref_name }}" == "develop"* ]]; then
                echo "release" >> $GITHUB_OUTPUT
              else
                echo "rc" >> $GITHUB_OUTPUT
              fi

          - name: Hotfix branch
            if: steps.check_branch.outputs == 'release'
            env:
              BRANCH_NAME: ${{ env.DLRS_VERSION}}
            run: |
              echo ${{ steps.check_branch.outputs }}/${{ env.BRANCH_NAME }} | sed 's/\./-/g'